@model EatWell.Models.WeeklyMenuModel

@{
    ViewBag.Title = "Add";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


@using (Html.BeginForm("Add", "WeeklyMenu", FormMethod.Post, new { id = "orderForm" }))
{
    @Html.AntiForgeryToken()

    <div class="form-horizontal">
        <h4 class="text-center">WeeklyMenu</h4>
        <hr />
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        <div class="col-md-12">
            <table class="table table-bordered">
                <tr>
                    <th class="text-center">Day</th>
                    <th class="text-center">Menu</th>
                    <th class="text-center">Items</th>
                    <th class="text-center">Price</th>
                </tr>
                @for (int i = 0; i < 7; i++)
                {
                    <tr>
                        <td>
                            @Enum.GetName(typeof(DayOfWeek), i)
                            @Html.HiddenFor(model => model.WeeklyMenuList[i].DayName, new { @Value = i })

                        </td>
                        <td>
                            @Html.DropDownListFor(model => model.WeeklyMenuList[i].MenuId, new SelectList(Model.Menus, "MenuId", "Name"), "Select Menu...",
                           new { @class = "form-control", @onchange = "ItemsLoad(this)" })
                        </td>
                        <td class="item"></td>
                        <td>
                            @Html.TextBox("Price", null, new { @class = "form-control", @readonly = "readonly" })
                        </td>

                    </tr>
                }

            </table>
        </div>
        <div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <input type="submit" value="Submit" class="btn btn-default" />
            </div>
        </div>
    </div>
}

<div>
    @Html.ActionLink("Back to List", "Index")
</div>

@section scripts {

    @Scripts.Render("~/bundles/jqueryval")
    <script>
         function ItemsLoad(obj) {
             var value = $(obj).val();
             if (value != '') {
                var url = '@Url.Action("GetMenuPriceById","Menu")';

                $.ajax({
                    type: "POST",
                    url: url,
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    data: JSON.stringify({ id: value }),
                    success: function (response)
                    {
                        $(obj).closest('tr').find('input[name="Price"]').val(response.Price);

                        var item = '';

                        $(response.items).each(function ()
                        {
                            item += '<span class="fa fa-arrow-right"> '+this+'</span>'

                        })
                        $(obj).closest('tr').find('[class="item"]').html(item);

                    },
                    error: function (response) {
                        alert('Error');
                    }
                });
             }

         }

    </script>


};




